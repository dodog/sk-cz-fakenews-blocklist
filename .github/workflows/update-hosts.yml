name: Update Fake News Hosts

on:
  schedule:
    - cron: '0 0 * * 0'
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - uses: actions/checkout@v3

    - name: Process and update hosts file
      run: |
        curl -s --fail -o source_list.txt https://konspiratori.sk/static/lists/zoznam_bez_score.txt
        echo "# Fake news blocklist" > hosts.txt
        echo "# Automatically updated $(date -u)" >> hosts.txt
        echo "# Source: https://konspiratori.sk" >> hosts.txt
        echo "" >> hosts.txt
        while IFS= read -r domain; do
          if [ -n "$domain" ]; then
            echo "0.0.0.0 $domain" >> hosts.txt
          fi
        done < source_list.txt

    - name: Commit and push changes
      run: |
        git config --local user.name "github-actions[bot]"
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git diff --quiet --exit-code hosts.txt || {
          git add hosts.txt
          git commit -m "chore: update hosts blocklist [skip ci]"
          git push
        }
