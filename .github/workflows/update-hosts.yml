name: Update Fake News Hosts

on:
  schedule:
    - cron: '0 0 * * 0'  # Every Sunday at 00:00 UTC
  workflow_dispatch:

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - uses: actions/checkout@v4
        
      - name: Download and create hosts file
        run: |
          # Create headers for the hosts file
          echo "# SK/CZ Fake news blocklist" > hosts.txt
          echo "# Updated: $(date)" >> hosts.txt
          echo "# Source: https://konspiratori.sk/static/lists/zoznam_bez_score.txt" >> hosts.txt
          echo "" >> hosts.txt
          
          # Download and format
          curl -s --fail https://konspiratori.sk/static/lists/zoznam_bez_score.txt | \
          while IFS= read -r domain; do
            [ -n "$domain" ] && echo "0.0.0.0 $domain"
          done >> hosts.txt
          
          # Show result
          echo "Created hosts.txt with $(wc -l < hosts.txt) total lines"
          echo "First few entries:"
          head -5 hosts.txt
      
      - name: Commit and push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add hosts.txt
          git commit -m "Update hosts blocklist [skip ci]"
          git push
